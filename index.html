<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dota 2 Timer Tool</title>
</head>
<body>
  <label for="timerSlider">Start-Offset (Sekunden):</label>
  <input type="range" id="timerSlider" name="timerSlider" min="-90" max="3600" value="0">
  <p>Aktueller Startwert: <span id="currentValue">0</span>s</p>

  ---
  <label for="modeSelect">Spielmodus:</label>
  <select id="modeSelect">
    <option value="normal" selected>Normal</option>
    <option value="turbo">Turbo</option>
  </select>
  <p>Lotus-Intervall: <span id="lotusIntervalDisplay">03:00</span></p>

  ---
  <h3>Offsets & Lautstärke je Event</h3>

  <label for="offsetRune">Rune Offset (Sekunden):</label>
  <input type="number" id="offsetRune" value="0" min="0">
  <p>Rune-Vorzug: <span id="offsetRuneDisplay">00:00</span></p>
  <label for="volumeRune">Rune Lautstärke:</label>
  <input type="range" id="volumeRune" min="0" max="100" value="100"><span id="volumeRuneDisplay">100%</span>

  <label for="offsetXpRune">XP Rune Offset (Sekunden):</label>
  <input type="number" id="offsetXpRune" value="0" min="0">
  <p>XP Rune-Vorzug: <span id="offsetXpRuneDisplay">00:00</span></p>
  <label for="volumeXpRune">XP Rune Lautstärke:</label>
  <input type="range" id="volumeXpRune" min="0" max="100" value="100"><span id="volumeXpRuneDisplay">100%</span>

  <label for="offsetLotus">Lotus Offset (Sekunden):</label>
  <input type="number" id="offsetLotus" value="0" min="0">
  <p>Lotus-Vorzug: <span id="offsetLotusDisplay">00:00</span></p>
  <label for="volumeLotus">Lotus Lautstärke:</label>
  <input type="range" id="volumeLotus" min="0" max="100" value="100"><span id="volumeLotusDisplay">100%</span>

  <label for="offsetTorm">Torm Offset (Sekunden):</label>
  <input type="number" id="offsetTorm" value="0" min="0">
  <p>Torm-Vorzug: <span id="offsetTormDisplay">00:00</span></p>
  <label for="volumeTorm">Torm Lautstärke:</label>
  <input type="range" id="volumeTorm" min="0" max="100" value="100"><span id="volumeTormDisplay">100%</span>

  <label for="offsetPull">Pull Offset (Sekunden):</label>
  <input type="number" id="offsetPull" value="0" min="0">
  <p>Pull-Vorzug: <span id="offsetPullDisplay">00:00</span></p>
  <label for="volumePull">Pull Lautstärke:</label>
  <input type="range" id="volumePull" min="0" max="100" value="100"><span id="volumePullDisplay">100%</span>

  ---
  <button id="startButton">Timer starten</button>
  <button id="stopButton">Timer stoppen</button>

  <script>
    // Interval constants (seconds)
    const RUNE_INTERVAL = 2 * 60;
    const XP_RUNE_INTERVAL = 7 * 60;
    const TORM_INTERVAL = 10 * 60;
    const LOTUS_INTERVAL_NORMAL = 3 * 60;
    const LOTUS_INTERVAL_TURBO = 90;
    const PULL_INTERVAL = 1 * 60;

    // Sound URLs
    const runeSoundUrl = 'sounds/river_rune.mp3';
    const xpRuneSoundUrl = 'sounds/xp_rune.mp3';
    const tormSoundUrl = 'sounds/torm.mp3';
    const lotusSoundUrl = 'sounds/lotus.mp3';
    const pullSoundUrl = 'sounds/pull.mp3';

    // Timers
    let runeTimer, xpRuneTimer, tormTimer, lotusTimer, pullTimer;
    let runeInitialTimer, xpRuneInitialTimer, tormInitialTimer, lotusInitialTimer, pullInitialTimer;
    let currentLotusInterval = LOTUS_INTERVAL_NORMAL;

    function playSound(url, volume) {
      const audio = new Audio(url);
      audio.volume = volume; // value between 0.0 and 1.0
      audio.play().catch(e => console.error("Fehler beim Abspielen des Sounds:", e));
    }

    function formatTime(seconds) {
      const isNegative = seconds < 0;
      const absSeconds = Math.abs(seconds);
      const minutes = Math.floor(absSeconds / 60);
      const remainingSeconds = absSeconds % 60;
      const formattedMinutes = minutes < 10 ? `0${minutes}` : `${minutes}`;
      const formattedSeconds = remainingSeconds < 10 ? `0${remainingSeconds}` : `${remainingSeconds}`;
      return isNegative ? `-${formattedMinutes}:${formattedSeconds}` : `${formattedMinutes}:${formattedSeconds}`;
    }

    function getNextTick(currentTimeMs, intervalMs) {
      const remainder = currentTimeMs % intervalMs;
      return remainder === 0 ? 0 : intervalMs - remainder;
    }

    function startTimers(initialOffsetInSeconds, offsets, volumes) {
      const initialOffsetMs = initialOffsetInSeconds * 1000;

      // Rune
      let runeDelay = getNextTick(initialOffsetMs, RUNE_INTERVAL * 1000) - offsets.rune * 1000;
      runeInitialTimer = setTimeout(() => {
        playSound(runeSoundUrl, volumes.rune);
        runeTimer = setInterval(() => playSound(runeSoundUrl, volumes.rune), RUNE_INTERVAL * 1000);
      }, Math.max(0, runeDelay));

      // XP Rune
      let xpRuneDelay = getNextTick(initialOffsetMs, XP_RUNE_INTERVAL * 1000) - offsets.xpRune * 1000;
      xpRuneInitialTimer = setTimeout(() => {
        playSound(xpRuneSoundUrl, volumes.xpRune);
        xpRuneTimer = setInterval(() => playSound(xpRuneSoundUrl, volumes.xpRune), XP_RUNE_INTERVAL * 1000);
      }, Math.max(0, xpRuneDelay));

      // Lotus
      let lotusDelay = getNextTick(initialOffsetMs, currentLotusInterval * 1000) - offsets.lotus * 1000;
      lotusInitialTimer = setTimeout(() => {
        playSound(lotusSoundUrl, volumes.lotus);
        lotusTimer = setInterval(() => playSound(lotusSoundUrl, volumes.lotus), currentLotusInterval * 1000);
      }, Math.max(0, lotusDelay));

      // Pull
      let pullDelay = getNextTick(initialOffsetMs, PULL_INTERVAL * 1000) - offsets.pull * 1000;
      pullInitialTimer = setTimeout(() => {
        playSound(pullSoundUrl, volumes.pull);
        pullTimer = setInterval(() => playSound(pullSoundUrl, volumes.pull), PULL_INTERVAL * 1000);
      }, Math.max(0, pullDelay));

      // Torm
      let tormDelay = getNextTick(initialOffsetMs, TORM_INTERVAL * 1000) - offsets.torm * 1000;
      tormInitialTimer = setTimeout(() => {
        playSound(tormSoundUrl, volumes.torm);
        tormTimer = setInterval(() => playSound(tormSoundUrl, volumes.torm), TORM_INTERVAL * 1000);
      }, Math.max(0, tormDelay));
    }

    function stopTimers() {
      clearInterval(runeTimer);
      clearInterval(xpRuneTimer);
      clearInterval(lotusTimer);
      clearInterval(tormTimer);
      clearInterval(pullTimer);
      clearTimeout(runeInitialTimer);
      clearTimeout(xpRuneInitialTimer);
      clearTimeout(lotusInitialTimer);
      clearTimeout(tormInitialTimer);
      clearTimeout(pullInitialTimer);

      const startButton = document.getElementById('startButton');
      const timerSlider = document.getElementById('timerSlider');
      const modeSelect = document.getElementById('modeSelect');

      startButton.disabled = false;
      timerSlider.disabled = false;
      modeSelect.disabled = false;
      startButton.textContent = 'Timer starten';
    }

    document.addEventListener('DOMContentLoaded', () => {
      const timerSlider = document.getElementById('timerSlider');
      const currentValueSpan = document.getElementById('currentValue');
      const startButton = document.getElementById('startButton');
      const stopButton = document.getElementById('stopButton');
      const modeSelect = document.getElementById('modeSelect');
      const lotusIntervalDisplay = document.getElementById('lotusIntervalDisplay');

      const offsetInputs = {
        rune: document.getElementById('offsetRune'),
        xpRune: document.getElementById('offsetXpRune'),
        lotus: document.getElementById('offsetLotus'),
        torm: document.getElementById('offsetTorm'),
        pull: document.getElementById('offsetPull'),
      };

      const offsetDisplays = {
        rune: document.getElementById('offsetRuneDisplay'),
        xpRune: document.getElementById('offsetXpRuneDisplay'),
        lotus: document.getElementById('offsetLotusDisplay'),
        torm: document.getElementById('offsetTormDisplay'),
        pull: document.getElementById('offsetPullDisplay'),
      };

      const volumeInputs = {
        rune: document.getElementById('volumeRune'),
        xpRune: document.getElementById('volumeXpRune'),
        lotus: document.getElementById('volumeLotus'),
        torm: document.getElementById('volumeTorm'),
        pull: document.getElementById('volumePull'),
      };

      const volumeDisplays = {
        rune: document.getElementById('volumeRuneDisplay'),
        xpRune: document.getElementById('volumeXpRuneDisplay'),
        lotus: document.getElementById('volumeLotusDisplay'),
        torm: document.getElementById('volumeTormDisplay'),
        pull: document.getElementById('volumePullDisplay'),
      };

      // Slider update
      timerSlider.addEventListener('input', () => {
        currentValueSpan.textContent = formatTime(parseInt(timerSlider.value, 10));
      });

      // Offset input updates
      Object.keys(offsetInputs).forEach(key => {
        offsetInputs[key].addEventListener('input', () => {
          offsetDisplays[key].textContent = formatTime(parseInt(offsetInputs[key].value, 10));
        });
      });

      // Volume input updates
      Object.keys(volumeInputs).forEach(key => {
        volumeInputs[key].addEventListener('input', () => {
          volumeDisplays[key].textContent = volumeInputs[key].value + "%";
        });
      });

      // Mode switch
      modeSelect.addEventListener('change', () => {
        currentLotusInterval = modeSelect.value === 'turbo' ? LOTUS_INTERVAL_TURBO : LOTUS_INTERVAL_NORMAL;
        lotusIntervalDisplay.textContent = formatTime(currentLotusInterval);
      });

      // Start
      startButton.addEventListener('click', () => {
        const initialDelay = parseInt(timerSlider.value, 10);
        const offsets = {
          rune: parseInt(offsetInputs.rune.value, 10),
          xpRune: parseInt(offsetInputs.xpRune.value, 10),
          lotus: parseInt(offsetInputs.lotus.value, 10),
          torm: parseInt(offsetInputs.torm.value, 10),
          pull: parseInt(offsetInputs.pull.value, 10),
        };
        const volumes = {
          rune: volumeInputs.rune.value / 100,
          xpRune: volumeInputs.xpRune.value / 100,
          lotus: volumeInputs.lotus.value / 100,
          torm: volumeInputs.torm.value / 100,
          pull: volumeInputs.pull.value / 100,
        };

        startButton.disabled = true;
        timerSlider.disabled = true;
        modeSelect.disabled = true;
        startButton.textContent = 'Timer läuft...';

        startTimers(initialDelay, offsets, volumes);
      });

      // Stop
      stopButton.addEventListener('click', () => stopTimers());

      // Init values
      currentValueSpan.textContent = formatTime(parseInt(timerSlider.value, 10));
      Object.keys(offsetInputs).forEach(key => {
        offsetDisplays[key].textContent = formatTime(parseInt(offsetInputs[key].value, 10));
      });
      Object.keys(volumeInputs).forEach(key => {
        volumeDisplays[key].textContent = volumeInputs[key].value + "%";
      });
      lotusIntervalDisplay.textContent = formatTime(currentLotusInterval);
    });
  </script>
</body>
</html>
