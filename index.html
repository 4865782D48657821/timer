<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dota 2 Timer Tool</title>
</head>
<body>
  <label for="timerSlider">Start-Offset (Sekunden):</label>
  <input type="range" id="timerSlider" name="timerSlider" min="-90" max="3600" value="0">
  <p>Aktueller Startwert: <span id="currentValue">0</span>s</p>

  ---
  <label for="playbackOffset">Vorziehen (Sekunden):</label>
  <input type="number" id="playbackOffset" name="playbackOffset" value="0" min="0">
  <p>Aktueller Vorzug: <span id="currentPlaybackOffset">0</span>s</p>

  ---
  <label for="modeSelect">Spielmodus:</label>
  <select id="modeSelect">
    <option value="normal" selected>Normal</option>
    <option value="turbo">Turbo</option>
  </select>
  <p>Lotus-Intervall: <span id="lotusIntervalDisplay">03:00</span></p>

  ---
  <button id="startButton">Timer starten</button>
  <button id="stopButton">Timer stoppen</button>

  <script>
    // Timings in Minuten und Konstanten f체r die Sounds
    const RUNE_INTERVAL_MIN = 2;
    const XP_RUNE_INTERVAL_MIN = 7;
    const TORM_INTERVAL_MIN = 10;
    const LOTUS_INTERVAL_NORMAL = 3 * 60;   // 180 Sekunden
    const LOTUS_INTERVAL_TURBO = 90;        // 90 Sekunden

    // URLs f체r die Sound-Dateien
    const runeSoundUrl = 'sounds/rune.mp3';
    const xpRuneSoundUrl = 'sounds/xp_rune.mp3';
    const tormSoundUrl = 'sounds/torm.mp3';
    const lotusSoundUrl = 'sounds/lotus.mp3';

    // Globale Variablen f체r Timer
    let runeTimer, xpRuneTimer, tormTimer, tormInitialTimer, lotusTimer, lotusInitialTimer;
    let currentLotusInterval = LOTUS_INTERVAL_NORMAL; // Default normal mode

    function playSound(url) {
      const audio = new Audio(url);
      audio.play().catch(e => console.error("Fehler beim Abspielen des Sounds:", e));
    }

    function formatTime(seconds) {
      const isNegative = seconds < 0;
      const absSeconds = Math.abs(seconds);
      const minutes = Math.floor(absSeconds / 60);
      const remainingSeconds = absSeconds % 60;
      const formattedMinutes = minutes < 10 ? `0${minutes}` : `${minutes}`;
      const formattedSeconds = remainingSeconds < 10 ? `0${remainingSeconds}` : `${remainingSeconds}`;
      return isNegative ? `-${formattedMinutes}:${formattedSeconds}` : `${formattedMinutes}:${formattedSeconds}`;
    }

    function getNextTick(currentTimeMs, intervalMs) {
      const remainder = currentTimeMs % intervalMs;
      return remainder === 0 ? 0 : intervalMs - remainder;
    }

    function startTimers(initialOffsetInSeconds, playbackOffsetInSeconds) {
      const initialOffsetInMilliseconds = initialOffsetInSeconds * 1000;
      const playbackOffsetInMilliseconds = playbackOffsetInSeconds * 1000;

      // Rune-Timer
      let runeDelay = getNextTick(initialOffsetInMilliseconds, RUNE_INTERVAL_MIN * 60 * 1000) - playbackOffsetInMilliseconds;
      setTimeout(() => {
        playSound(runeSoundUrl);
        runeTimer = setInterval(() => playSound(runeSoundUrl), RUNE_INTERVAL_MIN * 60 * 1000);
      }, Math.max(0, runeDelay));

      // XP Rune-Timer
      let xpRuneDelay = getNextTick(initialOffsetInMilliseconds, XP_RUNE_INTERVAL_MIN * 60 * 1000) - playbackOffsetInMilliseconds;
      setTimeout(() => {
        playSound(xpRuneSoundUrl);
        xpRuneTimer = setInterval(() => playSound(xpRuneSoundUrl), XP_RUNE_INTERVAL_MIN * 60 * 1000);
      }, Math.max(0, xpRuneDelay));

      // Torm-Timer
      let tormDelay = getNextTick(initialOffsetInMilliseconds, TORM_INTERVAL_MIN * 60 * 1000) - playbackOffsetInMilliseconds;
      tormInitialTimer = setTimeout(() => {
        playSound(tormSoundUrl);
        tormTimer = setInterval(() => playSound(tormSoundUrl), TORM_INTERVAL_MIN * 60 * 1000);
      }, Math.max(0, tormDelay));

      // Lotus-Timer
      let lotusDelay = getNextTick(initialOffsetInMilliseconds, currentLotusInterval * 1000) - playbackOffsetInMilliseconds;
      lotusInitialTimer = setTimeout(() => {
        playSound(lotusSoundUrl);
        lotusTimer = setInterval(() => playSound(lotusSoundUrl), currentLotusInterval * 1000);
      }, Math.max(0, lotusDelay));
    }

    function stopTimers() {
      clearInterval(runeTimer);
      clearInterval(xpRuneTimer);
      clearInterval(tormTimer);
      clearInterval(lotusTimer);
      clearTimeout(tormInitialTimer);
      clearTimeout(lotusInitialTimer);

      const startButton = document.getElementById('startButton');
      const timerSlider = document.getElementById('timerSlider');
      const playbackOffsetInput = document.getElementById('playbackOffset');
      const modeSelect = document.getElementById('modeSelect');

      startButton.disabled = false;
      timerSlider.disabled = false;
      playbackOffsetInput.disabled = false;
      modeSelect.disabled = false;
      startButton.textContent = 'Timer starten';
    }

    document.addEventListener('DOMContentLoaded', () => {
      const timerSlider = document.getElementById('timerSlider');
      const currentValueSpan = document.getElementById('currentValue');
      const playbackOffsetInput = document.getElementById('playbackOffset');
      const currentPlaybackOffsetSpan = document.getElementById('currentPlaybackOffset');
      const startButton = document.getElementById('startButton');
      const stopButton = document.getElementById('stopButton');
      const modeSelect = document.getElementById('modeSelect');
      const lotusIntervalDisplay = document.getElementById('lotusIntervalDisplay');

      timerSlider.addEventListener('input', () => {
        currentValueSpan.textContent = formatTime(parseInt(timerSlider.value, 10));
      });

      playbackOffsetInput.addEventListener('input', () => {
        currentPlaybackOffsetSpan.textContent = formatTime(parseInt(playbackOffsetInput.value, 10));
      });

      // Mode switch logic
      modeSelect.addEventListener('change', () => {
        if (modeSelect.value === 'turbo') {
          currentLotusInterval = LOTUS_INTERVAL_TURBO;
        } else {
          currentLotusInterval = LOTUS_INTERVAL_NORMAL;
        }
        lotusIntervalDisplay.textContent = formatTime(currentLotusInterval);
      });

      startButton.addEventListener('click', () => {
        const initialDelay = parseInt(timerSlider.value, 10);
        const playbackOffset = parseInt(playbackOffsetInput.value, 10);

        startButton.disabled = true;
        timerSlider.disabled = true;
        playbackOffsetInput.disabled = true;
        modeSelect.disabled = true;
        startButton.textContent = 'Timer l채uft...';

        startTimers(initialDelay, playbackOffset);
      });

      stopButton.addEventListener('click', () => stopTimers());

      currentValueSpan.textContent = formatTime(parseInt(timerSlider.value, 10));
      currentPlaybackOffsetSpan.textContent = formatTime(parseInt(playbackOffsetInput.value, 10));
      lotusIntervalDisplay.textContent = formatTime(currentLotusInterval);
    });
  </script>
</body>
</html>
