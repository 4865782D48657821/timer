<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dota 2 Timer Tool</title>
</head>
<body>
  <label for="timerSlider">Start-Offset (Sekunden):</label>
  <input type="range" id="timerSlider" name="timerSlider" min="-90" max="3600" value="0">
  <p>Aktueller Startwert: <span id="currentValue">0</span>s</p>

  ---
  <label for="modeSelect">Spielmodus:</label>
  <select id="modeSelect">
    <option value="normal" selected>Normal</option>
    <option value="turbo">Turbo</option>
  </select>
  <p>Lotus-Intervall: <span id="lotusIntervalDisplay">03:00</span></p>

  ---
  <h3>Offsets je Event</h3>
  <label for="offsetRune">Rune Offset (Sekunden):</label>
  <input type="number" id="offsetRune" value="0" min="0">
  <p>Rune-Vorzug: <span id="offsetRuneDisplay">00:00</span></p>

  <label for="offsetXpRune">XP Rune Offset (Sekunden):</label>
  <input type="number" id="offsetXpRune" value="0" min="0">
  <p>XP Rune-Vorzug: <span id="offsetXpRuneDisplay">00:00</span></p>

  <label for="offsetLotus">Lotus Offset (Sekunden):</label>
  <input type="number" id="offsetLotus" value="0" min="0">
  <p>Lotus-Vorzug: <span id="offsetLotusDisplay">00:00</span></p>

  <label for="offsetTorm">Torm Offset (Sekunden):</label>
  <input type="number" id="offsetTorm" value="0" min="0">
  <p>Torm-Vorzug: <span id="offsetTormDisplay">00:00</span></p>

  ---
  <button id="startButton">Timer starten</button>
  <button id="stopButton">Timer stoppen</button>

  <script>
    // Interval constants (seconds)
    const RUNE_INTERVAL = 2 * 60;
    const XP_RUNE_INTERVAL = 7 * 60;
    const TORM_INTERVAL = 10 * 60;
    const LOTUS_INTERVAL_NORMAL = 3 * 60;
    const LOTUS_INTERVAL_TURBO = 90;

    // Sound URLs
    const runeSoundUrl = 'sounds/rune.mp3';
    const xpRuneSoundUrl = 'sounds/xp_rune.mp3';
    const tormSoundUrl = 'sounds/torm.mp3';
    const lotusSoundUrl = 'sounds/lotus.mp3';

    // Timers
    let runeTimer, xpRuneTimer, tormTimer, lotusTimer;
    let runeInitialTimer, xpRuneInitialTimer, tormInitialTimer, lotusInitialTimer;
    let currentLotusInterval = LOTUS_INTERVAL_NORMAL;

    function playSound(url) {
      const audio = new Audio(url);
      audio.play().catch(e => console.error("Fehler beim Abspielen des Sounds:", e));
    }

    function formatTime(seconds) {
      const isNegative = seconds < 0;
      const absSeconds = Math.abs(seconds);
      const minutes = Math.floor(absSeconds / 60);
      const remainingSeconds = absSeconds % 60;
      const formattedMinutes = minutes < 10 ? `0${minutes}` : `${minutes}`;
      const formattedSeconds = remainingSeconds < 10 ? `0${remainingSeconds}` : `${remainingSeconds}`;
      return isNegative ? `-${formattedMinutes}:${formattedSeconds}` : `${formattedMinutes}:${formattedSeconds}`;
    }

    function getNextTick(currentTimeMs, intervalMs) {
      const remainder = currentTimeMs % intervalMs;
      return remainder === 0 ? 0 : intervalMs - remainder;
    }

    function startTimers(initialOffsetInSeconds, offsets) {
      const initialOffsetMs = initialOffsetInSeconds * 1000;

      // Rune
      let runeDelay = getNextTick(initialOffsetMs, RUNE_INTERVAL * 1000) - offsets.rune * 1000;
      runeInitialTimer = setTimeout(() => {
        playSound(runeSoundUrl);
        runeTimer = setInterval(() => playSound(runeSoundUrl), RUNE_INTERVAL * 1000);
      }, Math.max(0, runeDelay));

      // XP Rune
      let xpRuneDelay = getNextTick(initialOffsetMs, XP_RUNE_INTERVAL * 1000) - offsets.xpRune * 1000;
      xpRuneInitialTimer = setTimeout(() => {
        playSound(xpRuneSoundUrl);
        xpRuneTimer = setInterval(() => playSound(xpRuneSoundUrl), XP_RUNE_INTERVAL * 1000);
      }, Math.max(0, xpRuneDelay));

      // Lotus
      let lotusDelay = getNextTick(initialOffsetMs, currentLotusInterval * 1000) - offsets.lotus * 1000;
      lotusInitialTimer = setTimeout(() => {
        playSound(lotusSoundUrl);
        lotusTimer = setInterval(() => playSound(lotusSoundUrl), currentLotusInterval * 1000);
      }, Math.max(0, lotusDelay));

      // Torm
      let tormDelay = getNextTick(initialOffsetMs, TORM_INTERVAL * 1000) - offsets.torm * 1000;
      tormInitialTimer = setTimeout(() => {
        playSound(tormSoundUrl);
        tormTimer = setInterval(() => playSound(tormSoundUrl), TORM_INTERVAL * 1000);
      }, Math.max(0, tormDelay));
    }

    function stopTimers() {
      clearInterval(runeTimer);
      clearInterval(xpRuneTimer);
      clearInterval(lotusTimer);
      clearInterval(tormTimer);
      clearTimeout(runeInitialTimer);
      clearTimeout(xpRuneInitialTimer);
      clearTimeout(lotusInitialTimer);
      clearTimeout(tormInitialTimer);

      const startButton = document.getElementById('startButton');
      const timerSlider = document.getElementById('timerSlider');
      const modeSelect = document.getElementById('modeSelect');

      startButton.disabled = false;
      timerSlider.disabled = false;
      modeSelect.disabled = false;
      startButton.textContent = 'Timer starten';
    }

    document.addEventListener('DOMContentLoaded', () => {
      const timerSlider = document.getElementById('timerSlider');
      const currentValueSpan = document.getElementById('currentValue');
      const startButton = document.getElementById('startButton');
      const stopButton = document.getElementById('stopButton');
      const modeSelect = document.getElementById('modeSelect');
      const lotusIntervalDisplay = document.getElementById('lotusIntervalDisplay');

      const offsetInputs = {
        rune: document.getElementById('offsetRune'),
        xpRune: document.getElementById('offsetXpRune'),
        lotus: document.getElementById('offsetLotus'),
        torm: document.getElementById('offsetTorm'),
      };

      const offsetDisplays = {
        rune: document.getElementById('offsetRuneDisplay'),
        xpRune: document.getElementById('offsetXpRuneDisplay'),
        lotus: document.getElementById('offsetLotusDisplay'),
        torm: document.getElementById('offsetTormDisplay'),
      };

      // Slider update
      timerSlider.addEventListener('input', () => {
        currentValueSpan.textContent = formatTime(parseInt(timerSlider.value, 10));
      });

      // Offset input updates
      Object.keys(offsetInputs).forEach(key => {
        offsetInputs[key].addEventListener('input', () => {
          offsetDisplays[key].textContent = formatTime(parseInt(offsetInputs[key].value, 10));
        });
      });

      // Mode switch
      modeSelect.addEventListener('change', () => {
        currentLotusInterval = modeSelect.value === 'turbo' ? LOTUS_INTERVAL_TURBO : LOTUS_INTERVAL_NORMAL;
        lotusIntervalDisplay.textContent = formatTime(currentLotusInterval);
      });

      // Start
      startButton.addEventListener('click', () => {
        const initialDelay = parseInt(timerSlider.value, 10);
        const offsets = {
          rune: parseInt(offsetInputs.rune.value, 10),
          xpRune: parseInt(offsetInputs.xpRune.value, 10),
          lotus: parseInt(offsetInputs.lotus.value, 10),
          torm: parseInt(offsetInputs.torm.value, 10),
        };

        startButton.disabled = true;
        timerSlider.disabled = true;
        modeSelect.disabled = true;
        startButton.textContent = 'Timer lÃ¤uft...';

        startTimers(initialDelay, offsets);
      });

      // Stop
      stopButton.addEventListener('click', () => stopTimers());

      // Init values
      currentValueSpan.textContent = formatTime(parseInt(timerSlider.value, 10));
      Object.keys(offsetInputs).forEach(key => {
        offsetDisplays[key].textContent = formatTime(parseInt(offsetInputs[key].value, 10));
      });
      lotusIntervalDisplay.textContent = formatTime(currentLotusInterval);
    });
  </script>
</body>
</html>
